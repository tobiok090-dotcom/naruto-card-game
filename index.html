<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل الدخول - لعبة ناروتو</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* إخفاء محتوى الموقع في البداية */
#content {
    display: none;
}
:root {
  --primary-color: #d42027;
  --secondary-color: #f5b316;
  --dark-color: #1a0d0f;
  --light-color: #f8f1e5;
  --accent-color: #007bff;
  --success-color: #28a745;
  --red-color: #dc3545; /* Added red color */
  --blue-color: #007bff; /* Added blue color */
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Cairo', sans-serif;
  background-color: var(--dark-color);
  color: var(--light-color);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center; /* Center content vertically */
  min-height: 100vh;
  position: relative;
  direction: rtl; /* Added for right-to-left alignment */
}

#resizable-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: -1;
    background: linear-gradient(to bottom, var(--dark-color), #2e0f15);
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23d42027" opacity="0.1" d="M50,0 C77.614,0 100,22.386 100,50 C100,77.614 77.614,100 50,100 C22.386,100 0,77.614 0,50 C0,22.386 22.386,0 50,0 Z" /></svg>');
    background-size: 510px;
}

.content-wrapper {
    width: 100%;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.container {
  max-width: 1600px;
  width: 100%;
  margin: 0 auto;
}

header {
  text-align: center;
  margin-bottom: 30px;
  width: 100%;
}

header h1 {
  color: var(--secondary-color);
  font-size: 2.5rem;
  margin-bottom: 10px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

header p {
  font-size: 1.1rem;
  opacity: 0.9;
}

#round-counter {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: var(--light-color);
  padding: 10px 20px;
  border-radius: 10px;
  font-size: 1.2rem;
  font-weight: bold;
  z-index: 1000;
  border: 2px solid var(--secondary-color);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
}

h2, h3, h4 {
  margin: 15px 0;
  color: var(--secondary-color);
}

.deck-selection {
  max-width: 900px;
  width: 100%;
  text-align: center;
  background: rgba(26, 13, 15, 0.8);
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  margin-bottom: 20px;
  border: 1px solid var(--primary-color);
}

.deck-container, #rounds-container1, #rounds-container2 {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  margin-top: 15px;
}

.round-slot {
  width: 200px;
  height: 280px;
  border: 2px dashed var(--secondary-color);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  position: relative;
  cursor: pointer;
  background: rgba(255, 255, 255, 0.05);
  transition: all 0.3s ease;
}

.round-slot.selected {
  border: 3px solid var(--accent-color);
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0, 123, 255, 0.5);
}

.round-slot:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(212, 32, 39, 0.4);
  border-color: var(--primary-color);
}

.round-slot span {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 3;
  font-weight: bold;
  font-size: 18px;
  color: var(--light-color);
  background: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
}

.round-slot img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  border-radius: 10px;
  cursor: pointer;
  z-index: 2;
  transition: opacity 0.3s ease, filter 0.5s ease;
}

.round-slot.loading img {
  opacity: 0.5;
}

.round-slot.loading::after {
  content: "جاري التحميل...";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--light-color);
  font-weight: bold;
  z-index: 4;
}

.card-actions {
    position: absolute;
    bottom: 5px;
    left: 5px;
    z-index: 4;
    display: flex;
    gap: 5px;
}

.card-actions label {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.2s ease;
}

.card-actions label:hover {
    background: rgba(0, 0, 0, 0.9);
}

input[type="text"], input[type="number"], textarea, input[type="password"] {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--secondary-color);
  border-radius: 8px;
  padding: 10px;
  color: var(--light-color);
  font-family: 'Cairo', sans-serif;
  margin: 5px 0;
  width: 100%;
  max-width: 300px;
}

input[type="file"] {
    max-width: 100%;
}

input[type="text"]:focus, input[type="number"]:focus, textarea:focus, input[type="password"]:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 5px var(--primary-color);
}

label {
  display: block;
  margin: 10px 0;
  font-weight: bold;
}

button.main {
  margin-top: 15px;
  padding: 12px 25px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(to bottom, var(--primary-color), #a00);
  color: var(--light-color);
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
}

button.main:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.4);
  background: linear-gradient(to bottom, #e53b42, #b00);
}

button.main:active {
  transform: translateY(0);
  box-shadow: 2px 3px rgba(0, 0, 0, 0.3);
}

/* Battle Interface Styles */

#match {
  display: none;
  flex-direction: column;
  align-items: center;
  width: 100%;
  margin-top: 20px;
}

.players-container {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 30px;
  width: 100%;
  flex-wrap: wrap;
}

.player {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 750px;
  background: rgba(26, 13, 15, 0.8);
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  border: 1px solid var(--primary-color);
  text-align: center;
}

.player-name {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 15px;
  color: var(--secondary-color);
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
}

.card-and-abilities {
  display: flex;
  align-items: center;
  gap: 20px;
  width: 100%;
}

.abilities-container-side {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  width: 250px;
  flex-shrink: 0;
}

.ability-wrapper {
  background: rgba(0, 0, 0, 0.3);
  padding: 10px;
  border-radius: 10px;
  border: 1px solid var(--secondary-color);
  width: 100%;
  text-align: center;
}

.previous-card-container {
  min-height: 200px;
  width: 100%;
  border: 2px dashed #555;
  border-radius: 10px;
  margin-bottom: 15px;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.05);
}

.previous-card-container img {
  max-width: 100%;
  max-height: 80%;
  object-fit: contain;
  border-radius: 8px;
  opacity: 0.7;
}

.card {
  flex-grow: 1;
  width: 450px;
  height: 600px;
  border-radius: 12px;
  background: #222;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  border: 2px solid var(--secondary-color);
  transition: all 0.3s ease;
}

.card img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: transform 0.3s ease, filter 0.5s ease;
}

.card:hover img {
  transform: scale(1.05);
}

/* New foggy class for cards only */
.card-foggy {
    filter: blur(10px) brightness(0.7);
}

.hp-control {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 15px;
}

.hp-control .buttons {
  display: flex;
  justify-content: center;
  width: 100%;
}

.hp-control input {
  width: 80px;
  text-align: center;
  font-size: 20px;
  border-radius: 8px;
  border: 2px solid var(--primary-color);
  padding: 5px;
  margin: 8px 0;
  font-weight: bold;
  background: rgba(0, 0, 0, 0.3);
  color: var(--light-color);
}

.hp-control button {
  margin: 5px;
  padding: 8px 15px;
  cursor: pointer;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  transition: 0.2s;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.hp-control button.plus {
  background: var(--success-color);
  color: var(--light-color);
}
.hp-control button.minus {
  background: var(--primary-color);
  color: var(--light-color);
}

.hp-control button:hover.plus {
  background: #218838;
}
.hp-control button:hover.minus {
  background: #ff2222;
}

.hp-control button:hover {
  transform: translateY(-2px);
}

.player-notes-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    width: 100%;
    margin-top: 20px;
    flex-wrap: wrap;
}

.player-notes {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: calc(50% - 10px);
  padding: 15px;
  background: rgba(26, 13, 15, 0.8);
  border-radius: 15px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  border: 1px solid var(--primary-color);
}

.player-notes label {
  font-weight: bold;
  margin-bottom: 5px;
}

.player-notes textarea {
  font-size: 18px;
  font-family: 'Cairo', sans-serif, 'Arial', sans-serif;
  border-radius: 8px;
  padding: 10px;
  width: 100%;
  min-height: 100px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--secondary-color);
  color: var(--light-color);
  margin-top: 10px;
  resize: vertical;
}

.note-shortcuts {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
  margin-top: 10px;
  width: 100%;
}

.note-shortcut {
  padding: 8px 12px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s ease;
  background: #555;
  color: white;
}
.note-shortcut:hover {
  background: #777;
}

.note-shortcut.active {
  background: var(--accent-color);
  color: var(--light-color);
}

/* Styles for note shortcut colors */
.note-shortcut.red {
    background-color: var(--red-color);
}
.note-shortcut.green {
    background-color: var(--success-color);
}
.note-shortcut.blue {
    background-color: var(--blue-color);
}

.player-abilities {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 15px;
  width: 100%;
}

.abilities-container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 10px;
  margin-top: 10px;
  width: 100%;
}

.ability {
  /* حجم ثابت للقدرات */
  width: 100%;
  height: 60px; /* ارتفاع ثابت */
  min-height: 60px;
  max-height: 60px;
  
  /* المحتوى والنص */
  padding: 8px;
  background: linear-gradient(to bottom, var(--secondary-color), #d99c00);
  color: var(--dark-color);
  border-radius: 12px;
  cursor: pointer;
  user-select: none;
  font-weight: bold;
  text-align: center;
  transition: all 0.3s ease;
  border: 2px solid var(--dark-color);
  margin: 4px 0;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  
  /* تنسيق النص للحجم الثابت */
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  line-height: 1.2;
  overflow: hidden;
  word-wrap: break-word;
  hyphens: auto;
}

.ability:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
}

.ability.used {
  background: linear-gradient(to bottom, #cc6600, #994d00);
  color: var(--light-color);
  border: 2px solid var(--dark-color);
  opacity: 0.7;
}

/* تصغير النص تلقائياً للنصوص الطويلة */
.ability.long-text {
  font-size: 12px;
}

.ability.very-long-text {
  font-size: 10px;
}

.ability.extremely-long-text {
  font-size: 9px;
  line-height: 1.1;
}

.add-ability {
  margin-top: 15px;
  display: flex;
  gap: 10px;
  width: 100%;
  max-width: 300px;
}

.add-ability input {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid var(--secondary-color);
  background: rgba(255, 255, 255, 0.1);
  color: var(--light-color);
  font-family: 'Cairo', sans-serif;
}

.add-ability button {
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  background: var(--success-color);
  color: var(--light-color);
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.add-ability button:hover {
  background: #218838;
  transform: translateY(-2px);
}

#navigation {
  margin-top: 20px;
  display: none;
  gap: 15px;
  flex-wrap: wrap;
  justify-content: center;
}

#zoom-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  justify-content: center;
  align-items: center;
  z-index: 9999;
  cursor: pointer;
  flex-direction: column;
}

#zoom-modal img {
  max-width: 95%;
  max-height: 95%;
  border-radius: 10px;
  box-shadow: 0 0 30px var(--primary-color);
  border: 2px solid var(--secondary-color);
}

.transparency-control {
    position: absolute;
    bottom: 20px;
    right: 20px;
    display: none;
    align-items: center;
    gap: 10px;
    background: rgba(26, 13, 15, 0.7);
    padding: 10px 15px;
    border-radius: 20px;
    border: 1px solid var(--secondary-color);
    z-index: 10000;
}

.transparency-control label {
    font-size: 1rem;
    color: var(--light-color);
}

#transparency-slider {
    width: 120px;
    height: 6px;
    -webkit-appearance: none;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
    outline: none;
}

#transparency-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--secondary-color);
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}

#transparency-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--secondary-color);
    cursor: pointer;
    border: none;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}

.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: var(--light-color);
  animation: spin 1s ease-in-out infinite;
  margin-right: 10px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.status-message {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--success-color);
  color: white;
  padding: 10px 20px;
  border-radius: 5px;
  z-index: 10001;
  box-shadow: 0 3px 10px rgba(0,0,0,0.2);
  display: none;
}
.player-notes.right {
  order: 2;
}

.player-notes.left {
  order: 1;
}

.file-control {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
}

.file-control label.main {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    color: var(--light-color);
    background: linear-gradient(to bottom, var(--primary-color), #a00);
    padding: 12px 25px;
    border-radius: 8px;
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    border: none;
    margin: 15px 0 0 0;
}
.file-control label.main:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.4);
    background: linear-gradient(to bottom, #e53b42, #b00);
}
.file-control label.main:active {
    transform: translateY(0);
    box-shadow: 2px 3px rgba(0, 0, 0, 0.3);
}

/* Audio Controls Styles */
#audio-controls {
    position: fixed;
    top: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    background: rgba(26, 13, 15, 0.9);
    padding: 10px 15px;
    border-radius: 25px;
    border: 2px solid var(--secondary-color);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    z-index: 1000;
}

#mute-btn {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.3s ease;
    color: var(--light-color);
}

#mute-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}

#mute-btn.muted {
    color: var(--primary-color);
}

#volume-slider {
    width: 80px;
    height: 5px;
    border-radius: 5px;
    background: rgba(255, 255, 255, 0.2);
    outline: none;
    cursor: pointer;
}

#volume-slider::-webkit-slider-thumb {
    appearance: none;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: var(--secondary-color);
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}

#volume-slider::-moz-range-thumb {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: var(--secondary-color);
    cursor: pointer;
    border: none;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
}

.card-audio-indicator {
    position: absolute;
    top: 5px;
    right: 5px;
    background: var(--secondary-color);
    color: var(--dark-color);
    border-radius: 50%;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    z-index: 10;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.card:hover .card-audio-indicator {
    opacity: 1;
}

#bg-music-upload {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
}

#fullscreen-btn {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.3s ease;
    color: var(--light-color);
}
#fullscreen-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}
#fullscreen-icon {
    display: inline-block;
    width: 20px;
    height: 20px;
    line-height: 20px;
    text-align: center;
}

/* New CSS for ATK and DEF stats */
.card-stats {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 10px 0;
  width: 100%;
  align-items: flex-end; /* Align items at the bottom for better sizing */
}

.card-stats .stat-group {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.card-stats .stat-group label {
  font-size: 1rem;
  font-weight: bold;
  margin: 0;
  color: var(--secondary-color);
}

.card-stats .stat-group input {
  width: 60px;
  text-align: center;
  font-size: 18px;
  border-radius: 8px;
  border: 1px solid var(--secondary-color);
  padding: 5px;
  margin-top: 5px;
  background: rgba(0, 0, 0, 0.3);
  color: var(--light-color);
}

.card-stats .reset-button {
  padding: 5px 10px; /* Smaller padding for a more compact button */
  font-size: 14px;  /* Smaller font size */
  font-weight: bold;
  border: none;
  border-radius: 8px;
  background: var(--primary-color);
  color: var(--light-color);
  cursor: pointer;
  transition: all 0.3s ease;
  height: 40px; /* Match height of input fields */
}

.card-stats .reset-button:hover {
  background: #e53b42;
  transform: translateY(-2px);
}

.card-stats .reset-button:active {
  transform: translateY(0);
}

/* Styles for login page */
#login-page {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  max-width: 500px;
  width: 100%;
  padding: 40px;
  background: rgba(26, 13, 15, 0.8);
  border-radius: 20px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
  border: 2px solid var(--secondary-color);
  text-align: center;
  animation: fadeIn 1s ease-in-out;
}

#login-page h1 {
  font-size: 3.5rem;
  color: var(--primary-color);
  text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.7);
  margin-bottom: 20px;
}

#login-page .input-group {
  margin-bottom: 20px;
  width: 100%;
}

#login-page .input-group label {
  display: block;
  font-size: 1.2rem;
  font-weight: bold;
  color: var(--light-color);
  margin-bottom: 5px;
}

#login-page .input-group input {
  width: 100%;
  max-width: 300px;
  padding: 12px;
  font-size: 1.1rem;
  border-radius: 10px;
  border: 1px solid var(--secondary-color);
  background: rgba(255, 255, 255, 0.05);
  color: var(--light-color);
}

#login-page .login-btn {
  padding: 15px 40px;
  font-size: 1.2rem;
  font-weight: bold;
  border-radius: 12px;
  background: linear-gradient(to bottom, var(--secondary-color), #d99c00);
  color: var(--dark-color);
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
}

#login-page .login-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
}

#login-message {
  color: var(--red-color);
  font-weight: bold;
  margin-top: 15px;
  display: none;
}
</style>
<script>
    // بيانات تسجيل الدخول الصحيحة
    const correctUsername = "naruto-card-clash";
    const correctPassword = "katsuki123";

    function validateLogin() {
        const usernameInput = document.getElementById("username-input").value;
        const passwordInput = document.getElementById("password-input").value;
        const loginMessage = document.getElementById("login-message");

        if (usernameInput === correctUsername && passwordInput === correctPassword) {
            document.getElementById("login-page").style.display = "none";
            document.getElementById("content").style.display = "flex";
            document.title = "معركة ناروتو - لعبة البطاقات";
            playBackgroundMusic();
        } else {
            loginMessage.textContent = "اسم المستخدم أو كلمة السر غير صحيحة.";
            loginMessage.style.display = "block";
        }
    }
</script>
</head>
<body>

    <div id="login-page">
        <h1>مرحبا بك في لعبة ناروتو للبطاقات</h1>
        <div class="input-group">
            <label for="username-input">Username:</label>
            <input type="text" id="username-input" placeholder="أدخل اسم المستخدم">
        </div>
        <div class="input-group">
            <label for="password-input">Password:</label>
            <input type="password" id="password-input" placeholder="أدخل كلمة السر">
        </div>
        <button class="login-btn" onclick="validateLogin()">Continue</button>
        <span id="login-message"></span>
    </div>

    <div id="content">
        <div id="resizable-bg"></div>

        <div class="content-wrapper">
          <div class="container">
            <header>
              <h1>معركة ناروتو - لعبة البطاقات</h1>
              <p>قم بتحميل البطاقات وابدأ المعركة!</p>
              <div id="round-counter" style="display:none;"></div>
            </header>

            <div id="bg-music-upload">
              <label class="main">
                تحميل موسيقى الخلفية
                <input type="file" id="bg-music-file" accept="audio/*" style="display:none;">
              </label>
            </div>

            <div id="player1-interface" class="deck-selection">
              <h2>⮞ Deck اللاعب 1</h2>
              <label>عنوان Deck اللاعب 1: <input type="text" id="title1" placeholder="مثلاً فريق النار"></label>
              <label id="deck1-part1-label">تحميل 6 بطاقات: <input type="file" id="deck1-part1" accept="image/*" multiple></label>
              <label id="deck1-part2-label">تحميل 6 بطاقات: <input type="file" id="deck1-part2" accept="image/*" multiple></label>
              <label id="deck1-part3-label">تحميل 3 بطاقات: <input type="file" id="deck1-part3" accept="image/*" multiple></label>
              <h3>الجولات (1-15)</h3>
              <div id="rounds-container1"></div>
              
              <button class="main" onclick="toggleFogEffect()">تفعيل / إلغاء ضباب البطاقات</button>
              <button class="main" id="next-to-player2">التالي: لاعب 2 →</button>
            </div>

            <div id="player2-interface" class="deck-selection" style="display:none;">
              <h2>⮞ Deck اللاعب 2</h2>
              <label>عنوان Deck اللاعب 2: <input type="text" id="title2" placeholder="مثلاً فريق الرياح"></label>
              <label id="deck2-part1-label">تحميل 6 بطاقات: <input type="file" id="deck2-part1" accept="image/*" multiple></label>
              <label id="deck2-part2-label">تحميل 6 بطاقات: <input type="file" id="deck2-part2" accept="image/*" multiple></label>
              <label id="deck2-part3-label">تحميل 3 بطاقات: <input type="file" id="deck2-part3" accept="image/*" multiple></label>
              <h3>الجولات (1-15)</h3>
              <div id="rounds-container2"></div>
              
              <div class="file-control">
                  <button class="main" onclick="exportGameData()">تحميل الملف</button>
                  <label class="main">
                      استيراد الملف
                      <input type="file" id="import-file" accept=".json" style="display:none;" onchange="importGameData(event)">
                  </label>
              </div>

              <button class="main" onclick="toggleFogEffect()">تفعيل / إلغاء ضباب البطاقات</button>
              <button class="main" id="back-to-player1">← عودة: لاعب 1</button>
              <button class="main" id="start-game-btn">بدء المعركة!</button>
            </div>

            <div id="match" style="display:none;">
              <div class="players-container">
                <div class="player">
                  <div class="player-name" id="player1-title">اللاعب 1</div>
                  <div class="card-and-abilities">
                    <div class="abilities-container-side">
                      <div class="ability-wrapper">
                        <h4>البطاقة السابقة</h4>
                        <div class="previous-card-container">
                          <img id="previous-card1" src="">
                        </div>
                      </div>
                      <h4>القدرات</h4>
                      <div class="abilities-container" id="player1-abilities"></div>
                      <div class="add-ability">
                        <input id="new-ability1" placeholder="اكتب قدرة جديدة">
                        <button onclick="addAbility('player1')">أضف</button>
                      </div>
                    </div>
                    <div>
                      <label>تحميل بطاقة جديدة:
                        <input type="file" accept="image/*" onchange="replaceCard(event, 1)">
                      </label>
                      <div class="card" id="player1-card">
                        <img id="card1" src="">
                      </div>
                      <div class="card-stats">
                          <div class="stat-group">
                              <label for="def1">DEF</label>
                              <input type="number" id="def1" min="0">
                          </div>
                          <div class="stat-group">
                              <label for="atk1">ATK</label>
                              <input type="number" id="atk1" min="0">
                          </div>
                          <button class="reset-button" onclick="resetStats(1)">Reset</button>
                      </div>
                      <div class="hp-control">
                        <label>نقاط الصحة (HP)</label>
                        <div class="buttons">
                          <button class="minus" onclick="changeHP(1, -1)">-</button>
                          <input type="number" id="hp1" value="15" min="0">
                          <button class="plus" onclick="changeHP(1, 1)">+</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="player">
                  <div class="player-name" id="player2-title">اللاعب 2</div>
                  <div class="card-and-abilities">
                    <div>
                      <label>تحميل بطاقة جديدة:
                        <input type="file" accept="image/*" onchange="replaceCard(event, 2)">  </label>
                      <div class="card" id="player2-card">
                        <img id="card2" src="">
                      </div>
                      <div class="card-stats">
                          <div class="stat-group">
                              <label for="def2">DEF</label>
                              <input type="number" id="def2" min="0">
                          </div>
                          <div class="stat-group">
                              <label for="atk2">ATK</label>
                              <input type="number" id="atk2" min="0">
                          </div>
                          <button class="reset-button" onclick="resetStats(2)">Reset</button>
                      </div>
                      <div class="hp-control">
                        <label>نقاط الصحة (HP)</label>
                        <div class="buttons">
                          <button class="minus" onclick="changeHP(2, -1)">-</button>
                          <input type="number" id="hp2" value="15" min="0">
                          <button class="plus" onclick="changeHP(2, 1)">+</button>
                        </div>
                      </div>
                    </div>
                    <div class="abilities-container-side">
                      <div class="ability-wrapper">
                        <h4>البطاقة السابقة</h4>
                        <div class="previous-card-container">
                          <img id="previous-card2" src="">
                        </div>
                      </div>
                      <h4>القدرات</h4>
                      <div class="abilities-container" id="player2-abilities"></div>
                      <div class="add-ability">
                        <input id="new-ability2" placeholder="اكتب قدرة جديدة">
                        <button onclick="addAbility('player2')">أضف</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="player-notes-container">
                <div class="player-notes left">
                  <label>Player Notes:</label>
                  <div class="note-shortcuts" id="shortcuts1">
                    </div>
                  <textarea id="notes1" rows="2" placeholder="Typing notes here..."></textarea>
                </div>
                <div class="player-notes right">
                  <label>Player Notes:</label>
                  <div class="note-shortcuts" id="shortcuts2">
                    </div>
                  <textarea id="notes2" rows="2" placeholder="Typing notes here..."></textarea>
                </div>
              </div>
            </div>

            <div id="navigation">
              <button class="main" onclick="prevRound()">← السابق</button>
              <button class="main" onclick="toggleFogEffect()">تفعيل / إلغاء ضباب البطاقات</button>
              <button class="main" onclick="nextRound()">التالي →</button>
            </div>
          </div>

          <div id="zoom-modal">
            <img id="zoom-img" src="">
            <div class="transparency-control">
              <label for="transparency-slider">الشفافية:</label>
              <input type="range" id="transparency-slider" min="0" max="100" value="95">
            </div>
          </div>

          <div class="status-message" id="status-message"></div>
          
          <div id="audio-controls">
            <button id="mute-btn" title="كتم/إلغاء كتم الصوت">🔊</button>
            <input type="range" id="volume-slider" min="0" max="100" value="50" title="مستوى الصوت">
            <button id="fullscreen-btn" title="ملء الشاشة">
              <span id="fullscreen-icon">⛶</span>
            </button>
          </div>
          
          <audio id="background-music" loop></audio>
        </div>
    </div>

<script>
let backgroundMusic = null;
let cardSounds = {};
let isMuted = false;
let currentVolume = 0.5;
let clickTimeout;
let totalRounds = 15;
let currentRound = 1;
let deck1 = [], deck2 = [];
let selectedSlot = null;
let previousCard1 = '', previousCard2 = '';
let lastClickedShortcut = { player: null, time: 0, text: '' };

const noteShortcuts = [
  '+5 ATK', '-5 ATK', '+5 DEF', '-5 DEF', '+5 ATK/DEF', '-5 ATK/DEF', '+10 ATK', '-10 ATK', '+10 DEF', '-10 DEF', 'NEXT'
];

function initAudioSystem() {
    backgroundMusic = document.getElementById('background-music');
    const muteBtn = document.getElementById('mute-btn');
    const volumeSlider = document.getElementById('volume-slider');
    const bgMusicFile = document.getElementById('bg-music-file');

    bgMusicFile.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                backgroundMusic.src = event.target.result;
                showStatus('تم تحميل موسيقى الخلفية بنجاح.');
                playBackgroundMusic();
            };
            reader.readAsDataURL(file);
        }
    });
    
    if (backgroundMusic) {
        backgroundMusic.volume = currentVolume;
    }
    
    muteBtn.addEventListener('click', () => {
        isMuted = !isMuted;
        if (backgroundMusic) {
            backgroundMusic.muted = isMuted;
        }
        muteBtn.textContent = isMuted ? '🔇' : '🔊';
        muteBtn.classList.toggle('muted', isMuted);
        
        showStatus(isMuted ? 'تم كتم الصوت' : 'تم إلغاء كتم الصوت');
    });
    
    volumeSlider.addEventListener('input', (e) => {
        currentVolume = e.target.value / 100;
        if (backgroundMusic) {
            backgroundMusic.volume = currentVolume;
        }
        Object.values(cardSounds).forEach(audio => {
            if (audio) audio.volume = currentVolume;
        });
    });
}

function playBackgroundMusic() {
    if (backgroundMusic && !isMuted) {
        backgroundMusic.currentTime = 0;
        const playPromise = backgroundMusic.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.log('خطأ في تشغيل الموسيقى الخلفية:', error);
            });
        }
    }
}

function stopBackgroundMusic() {
    if (backgroundMusic) {
        backgroundMusic.pause();
        backgroundMusic.currentTime = 0;
    }
}

function addSoundToCard(cardIndex, audioFile, player) {
    const key = `${player}_${cardIndex}`;
    if (audioFile && audioFile.size > 0) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const audioDataUrl = e.target.result;
            if (player === 1) {
                deck1[cardIndex].sound = audioDataUrl;
            } else {
                deck2[cardIndex].sound = audioDataUrl;
            }
            
            showStatus(`تم إضافة صوت للبطاقة ${cardIndex + 1} - اللاعب ${player}`);
        };
        reader.readAsDataURL(audioFile);
    }
}

function playCardSound(cardIndex, player) {
    return new Promise((resolve, reject) => {
        const deck = player === 1 ? deck1 : deck2;
        const cardData = deck[cardIndex];
        if (cardData && cardData.sound && !isMuted) {
            const audio = new Audio(cardData.sound);
            audio.volume = currentVolume;
            audio.currentTime = 0;
            audio.onended = () => resolve(); 
            audio.onerror = () => reject(new Error("Audio playback error")); 
            
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log('خطأ في تشغيل صوت البطاقة:', error);
                    reject(error);
                });
            }
        } else {
            resolve(); 
        }
    });
}

function Card(image, sound) {
    this.image = image;
    this.sound = sound;
}

function createRoundSlots(containerId, deck) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    for (let i = 0; i < totalRounds; i++) {
        const slot = document.createElement('div');
        slot.className = 'round-slot';
        slot.setAttribute('data-round', i + 1);
        slot.setAttribute('data-index', i);

        const span = document.createElement('span');
        span.textContent = i + 1;
        slot.appendChild(span);

        const img = document.createElement('img');
        img.src = 'images/back.png';
        slot.appendChild(img);
        
        const cardActions = document.createElement('div');
        cardActions.className = 'card-actions';

        const audioLabel = document.createElement('label');
        audioLabel.textContent = '🔊';
        audioLabel.htmlFor = `card-audio-${containerId.includes('1') ? 1 : 2}-${i}`;

        const audioInput = document.createElement('input');
        audioInput.type = 'file';
        audioInput.id = `card-audio-${containerId.includes('1') ? 1 : 2}-${i}`;
        audioInput.accept = 'audio/*';
        audioInput.style.display = 'none';
        
        audioInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            const player = containerId.includes('1') ? 1 : 2;
            addSoundToCard(i, file, player);
        });

        cardActions.appendChild(audioLabel);
        cardActions.appendChild(audioInput);
        slot.appendChild(cardActions);

        container.appendChild(slot);
        
        deck[i] = new Card('images/back.png', null);
        setupSlotEvents(slot);
    }
}

function placeCardsForGroup(files, containerId, groupIndex, count) {
  const slots = document.getElementById(containerId).querySelectorAll('.round-slot');
  const startIdx = groupIndex === 0 ? 0 : groupIndex === 1 ? 6 : 12;
  const copyFiles = [...files];
  const selectedFiles = [];
  
  for (let i = 0; i < count; i++) {
    if (copyFiles.length === 0) break;
    const idx = Math.floor(Math.random() * copyFiles.length);
    selectedFiles.push(copyFiles.splice(idx, 1)[0]);
  }

  const decks = containerId.includes('1') ? deck1 : deck2;
  
  selectedFiles.forEach((file, i) => {
    const slot = slots[startIdx + i];
    slot.classList.add('loading');
    
    const reader = new FileReader();
    reader.onload = function(event) {
      const url = event.target.result;
      const img = slot.querySelector('img');
      img.src = url;
      img.onload = function() {
        slot.classList.remove('loading');
      };
      decks[startIdx + i].image = url;
      setupSlotEvents(slot);
    };
    reader.readAsDataURL(file);
  });
}

['deck1-part1', 'deck1-part2', 'deck1-part3'].forEach((id, index) => {
  document.getElementById(id).addEventListener('change', e => {
    placeCardsForGroup(Array.from(e.target.files), 'rounds-container1', index, [6, 6, 3][index]);
  });
});

['deck2-part1', 'deck2-part2', 'deck2-part3'].forEach((id, index) => {
  document.getElementById(id).addEventListener('change', e => {
    placeCardsForGroup(Array.from(e.target.files), 'rounds-container2', index, [6, 6, 3][index]);
  });
});

document.getElementById('next-to-player2').addEventListener('click', () => {
  document.getElementById('player1-interface').style.display = 'none';
  document.getElementById('player2-interface').style.display = 'block';
  playBackgroundMusic();
});

document.getElementById('back-to-player1').addEventListener('click', () => {
  document.getElementById('player1-interface').style.display = 'block';
  document.getElementById('player2-interface').style.display = 'none';
  playBackgroundMusic();
});

function setupSlotEvents(slot) {
  const containerId = slot.parentElement.id;
  const index = parseInt(slot.getAttribute('data-index'));

  slot.addEventListener('mousedown', (e) => {
    clearTimeout(clickTimeout);
    clickTimeout = setTimeout(() => {
      const deck = containerId.includes('1') ? deck1 : deck2;
      const allSlots = document.getElementById(containerId).querySelectorAll('.round-slot');
      
      if (!selectedSlot) {
        selectedSlot = { containerId, index };
        slot.classList.add('selected');
      } else {
        if (selectedSlot.containerId === containerId) {
          const tempCard = deck[selectedSlot.index];
          deck[selectedSlot.index] = deck[index];
          deck[index] = tempCard;

          const img1 = allSlots[selectedSlot.index].querySelector('img');
          const img2 = allSlots[index].querySelector('img');

          if (img1) img1.src = deck[selectedSlot.index].image;
          if (img2) img2.src = deck[index].image;
          
          allSlots.forEach(s => s.classList.remove('selected'));
          selectedSlot = null;
        } else {
          allSlots.forEach(s => s.classList.remove('selected'));
          selectedSlot = null;
        }
      }
    }, 200);
  });
  
  // FIX: Add a double-click event listener to each slot here
  slot.addEventListener('dblclick', (e) => {
      clearTimeout(clickTimeout);
      const img = slot.querySelector('img');
      if (img && img.src) {
          showZoomModal(img.src);
      }
  });
}

async function loadRound(round) {
    currentRound = round;
    document.getElementById('round-counter').textContent = `الجولة ${round} / ${totalRounds}`;
    
    if (currentRound > 1) {
      previousCard1 = deck1[currentRound - 2].image;
      previousCard2 = deck2[currentRound - 2].image;
    } else {
      previousCard1 = '';
      previousCard2 = '';
    }
  
    document.getElementById('previous-card1').src = previousCard1 || 'images/back.png';
    document.getElementById('previous-card2').src = previousCard2 || 'images/back.png';
    
    if (deck1[round - 1]) {
      document.getElementById('card1').src = deck1[round - 1].image;
    } else {
      document.getElementById('card1').src = 'images/back.png';
    }
  
    if (deck2[round - 1]) {
      document.getElementById('card2').src = deck2[round - 1].image;
    } else {
      document.getElementById('card2').src = 'images/back.png';
    }
  
    document.querySelector('title').textContent = `معركة ناروتو - الجولة ${round}`;

    await playCardSound(round - 1, 1);
    await playCardSound(round - 1, 2);
}

document.getElementById('start-game-btn').addEventListener('click', () => {
  const title1 = document.getElementById('title1').value || 'اللاعب 1';
  const title2 = document.getElementById('title2').value || 'اللاعب 2';
  document.getElementById('player1-title').textContent = title1;
  document.getElementById('player2-title').textContent = title2;
  
  document.getElementById('player1-interface').style.display = 'none';
  document.getElementById('player2-interface').style.display = 'none';

  document.getElementById('match').style.display = 'flex';
  document.getElementById('navigation').style.display = 'flex';
  document.getElementById('round-counter').style.display = 'block';
  
  stopBackgroundMusic();
  loadAbilities();
  loadRound(1);
});

function backToHome() {
  document.getElementById('player1-interface').style.display = 'block';
  document.getElementById('player2-interface').style.display = 'none';
  document.getElementById('match').style.display = 'none';
  document.getElementById('navigation').style.display = 'none';
  document.getElementById('round-counter').style.display = 'none';
  
  playBackgroundMusic();
}

function nextRound() {
  if (currentRound < totalRounds) {
    loadRound(currentRound + 1);
  } else {
    showStatus('هذه هي الجولة الأخيرة!', 'error');
  }
}

function prevRound() {
  if (currentRound > 1) {
    loadRound(currentRound - 1);
  } else {
    backToHome();
  }
}

function changeHP(player, value) {
  const hpElement = document.getElementById(`hp${player}`);
  let hp = parseInt(hpElement.value) + value;
  if (hp < 0) hp = 0;
  hpElement.value = hp;
}

function resetStats(player) {
  document.getElementById(`atk${player}`).value = '';
  document.getElementById(`def${player}`).value = '';
}

function replaceCard(event, player) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
        const url = e.target.result;
        document.getElementById(`card${player}`).src = url;
        if (player === 1) {
            deck1[currentRound - 1].image = url;
        } else {
            deck2[currentRound - 1].image = url;
        }
    };
    reader.readAsDataURL(file);
  }
}

function addAbility(player) {
  const input = document.getElementById(`new-ability${player === 'player1' ? '1' : '2'}`);
  const abilityText = input.value.trim();
  if (abilityText) {
    const container = document.getElementById(`${player}-abilities`);
    const abilityElement = document.createElement('div');
    abilityElement.className = 'ability';
    abilityElement.textContent = abilityText;
    
    // إضافة فئة CSS حسب طول النص لتصغير الخط تلقائياً
    adjustAbilityFontSize(abilityElement, abilityText);
    
    abilityElement.addEventListener('click', function() {
      this.classList.toggle('used');
    });
    container.appendChild(abilityElement);
    input.value = '';
  }
}

// دالة لتعديل حجم الخط حسب طول النص
function adjustAbilityFontSize(element, text) {
  const textLength = text.length;
  
  // إزالة فئات الحجم السابقة
  element.classList.remove('long-text', 'very-long-text', 'extremely-long-text');
  
  if (textLength > 120) {
    element.classList.add('extremely-long-text');
  } else if (textLength > 80) {
    element.classList.add('very-long-text');
  } else if (textLength > 50) {
    element.classList.add('long-text');
  }
}

function createNoteShortcuts(player, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  noteShortcuts.forEach(text => {
    const button = document.createElement('button');
    button.className = 'note-shortcut';
    button.textContent = text;
    button.onclick = () => toggleNoteShortcut(player, text, button);
    container.appendChild(button);
  });
}

function toggleNoteShortcut(player, text, element) {
  const notesTextarea = document.getElementById(`notes${player}`);
  let currentText = notesTextarea.value.trim();
  const notesArray = currentText.split('\n').filter(line => line.trim() !== '');
  const lineIndex = notesArray.indexOf(text);

  if (element.classList.contains('active')) {
    // If active, remove it
    if (lineIndex !== -1) {
      notesArray.splice(lineIndex, 1);
    }
    element.classList.remove('active', 'green', 'red', 'blue');
  } else {
    // If not active, add it and change color
    notesArray.push(text);
    element.classList.add('active');
    if (text.includes('+')) {
      element.classList.add('green');
    } else if (text.includes('-')) {
      element.classList.add('red');
    } else if (text.includes('NEXT')) {
      element.classList.add('blue');
    }
  }

  notesTextarea.value = notesArray.join('\n');
}

function showZoomModal(src) {
  const zoomModal = document.getElementById('zoom-modal');
  const transparencyControl = document.querySelector('.transparency-control');
  const transparencySlider = document.getElementById('transparency-slider');

  document.getElementById('zoom-img').src = src;
  zoomModal.style.display = 'flex';
  transparencyControl.style.display = 'flex';
  const initialOpacity = transparencySlider.value / 100;
  zoomModal.style.backgroundColor = `rgba(0, 0, 0, ${initialOpacity})`;
}

document.getElementById('zoom-modal').addEventListener('click', function(event) {
  if (event.target === this) {
    this.style.display = 'none';
    document.querySelector('.transparency-control').style.display = 'none';
  }
});

function showStatus(message, type = 'success') {
  const statusElement = document.getElementById('status-message');
  statusElement.textContent = message;
  statusElement.style.background = type === 'success' ? 'var(--success-color)' : 'var(--primary-color)';
  statusElement.style.display = 'block';
  setTimeout(() => {
    statusElement.style.display = 'none';
  }, 3000);
}

function loadDeckFromData(data) {
    if (data.title1) {
        document.getElementById('title1').value = data.title1;
    }
    if (data.deck1 && data.deck1.length > 0) {
        deck1 = data.deck1;
        loadDeckFromUrl('rounds-container1', data.deck1);
    }
    if (data.title2) {
        document.getElementById('title2').value = data.title2;
    }
    if (data.deck2 && data.deck2.length > 0) {
        deck2 = data.deck2;
        loadDeckFromUrl('rounds-container2', data.deck2);
    }
}

function loadDeckFromUrl(containerId, deckData) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    for (let i = 0; i < totalRounds; i++) {
        const slot = document.createElement('div');
        slot.className = 'round-slot';
        slot.setAttribute('data-round', i + 1);
        slot.setAttribute('data-index', i);

        const img = document.createElement('img');
        const cardData = deckData[i] || { image: 'images/back.png', sound: null };
        img.src = cardData.image;
        
        const span = document.createElement('span');
        span.textContent = i + 1;
        slot.appendChild(span);
        slot.appendChild(img);

        const cardActions = document.createElement('div');
        cardActions.className = 'card-actions';

        const audioLabel = document.createElement('label');
        audioLabel.textContent = '🔊';
        audioLabel.htmlFor = `card-audio-${containerId.includes('1') ? 1 : 2}-${i}`;

        const audioInput = document.createElement('input');
        audioInput.type = 'file';
        audioInput.id = `card-audio-${containerId.includes('1') ? 1 : 2}-${i}`;
        audioInput.accept = 'audio/*';
        audioInput.style.display = 'none';
        
        audioInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            const player = containerId.includes('1') ? 1 : 2;
            addSoundToCard(i, file, player);
        });

        cardActions.appendChild(audioLabel);
        cardActions.appendChild(audioInput);
        slot.appendChild(cardActions);
        
        container.appendChild(slot);
        
        // FIX: The crucial fix is here. The event listeners must be re-attached
        // to the newly created slots to enable zoom.
        setupSlotEvents(slot);
    }
}

function loadAbilities() {
  const player1AbilitiesContainer = document.getElementById('player1-abilities');
  const player2AbilitiesContainer = document.getElementById('player2-abilities');

  player1AbilitiesContainer.innerHTML = '';
  player2AbilitiesContainer.innerHTML = '';

  const allAbilities = [
    "الدرع : يحميك من الخسارة و الخاصية", "العلاج : تستعيد النقطة التي خسرتها هذه الجولة", "دوبل او لا شيى : إن فزت بالجولة القادمة تزيد نقطة صحة وإن خسرت تنقص نقطتين", "احياء : اعادة بطاقة سابقة بنصف قوتها مع خاصيتها", "احياء خاصية : اعادة خاصية بطاقة سابقة", "الإنفجار : عند الخسارة تنقص جميع بطاقات الاعب نقطة هجوم و دفاع", "تبديل : تصبح بطاقة الخصم بطاقتك و العكس", "الغاء قدرات الخصم هذه الجولة", "تجميد : تلغى خاصية بطاقة الخصم و قدراته", "الإنتحار : عند الخسارة يموت الخصم معك", "تقوية : مظاعفة نقاط البطاقة الحالية", "تظعيف : تفقد بطاقة الخصم نصف طاقاتها", "نسخ الخاصية : تنسخ خاصية بطاقة الخصم الحالية", "نسخ القدرة : تنسخ احد قدرات الخصم", "سرقة : تسرق خاصية الخصم او احد قدراته", "مسح : مسح احد قدرات الخصم من إختيارك", "القنص : إختار جولة معينة لتفوز بها ", "هاكي : توقع هجوم بطاقة الخصم القادمة لتزيد نقطة صحة ", "سرقة : سرقة بوفات الخصم", "الختم : اختم قدرة للخصم 3 جولات قادمة ", "الانتحار : مع الخسارة ينقص الخصم معك", "مسح : مسح بوفات الخصم فقط ", "تنظيف : مسح كل التأثيرات لك و الخصم", "الاختراق : نقاط دفاع الخصم 0 ", "السلب : تاخد بوف من بوفات الخصم ", "سكب : تسكب الجولة دون إحتساب شيئ", "لايف ستيل : مع الفوز تزيد نقطة صحة ","الجشع : عند الفوز تزيد كل الكروت عندك 1 هجوم","استدعاء : اعادة كرت لك بكل قوته بدون خاصية","الحماية : لا تنقص اي نقطة صحة هذه الجولة ","بوست : تضاعف نقاط هجومك او دفاعك ","الهاوية : نقاط هجوم الخصم 0","تغيير: تغير قدرة لك بقدرة لدى الخصم و العكس","عكس : تعكس طاقات بطاقتك مع الخصم","كونتر : تطبق خاصية الخصم عليه بشكل سلبي","دمج : دمج نصف طاقات بطاقتك الحالية مع نصف السابقة","تركيب : يمكنك اخد هجوم او دفاع بطاقتك السابقة و استخدامه الان","تخصص : يمكنك تغيير فئة بطاقاتك الى ما تريد"
  ];

  function createAbilityElement(abilityText) {
    const abilityElement = document.createElement('div');
    abilityElement.className = 'ability';
    abilityElement.textContent = abilityText;
    
    // تطبيق تعديل حجم الخط حسب طول النص
    adjustAbilityFontSize(abilityElement, abilityText);
    
    abilityElement.addEventListener('click', function() {
      this.classList.toggle('used');
    });
    return abilityElement;
  }

  const shuffledAbilities = [...allAbilities].sort(() => 0.5 - Math.random());
  
  const player1Abilities = shuffledAbilities.slice(0, 5);
  const player2Abilities = shuffledAbilities.slice(5, 10);

  player1Abilities.forEach(abilityText => {
    player1AbilitiesContainer.appendChild(createAbilityElement(abilityText));
  });

  player2Abilities.forEach(abilityText => {
    player2AbilitiesContainer.appendChild(createAbilityElement(abilityText));
  });
}

function handleTextDirection(textarea) {
    textarea.addEventListener('input', function() {
        const firstChar = this.value.trim().charAt(0);
        if (/[a-zA-Z]/.test(firstChar)) {
            this.style.direction = 'ltr';
        } else {
            this.style.direction = 'rtl';
        }
    });
}

function exportGameData() {
    const gameData = {
        title1: document.getElementById('title1').value || 'اللاعب 1',
        deck1: deck1,
        title2: document.getElementById('title2').value || 'اللاعب 2',
        deck2: deck2
    };

    if (deck1.filter(card => card.image && card.image !== 'images/back.png').length === 0 && deck2.filter(card => card.image && card.image !== 'images/back.png').length === 0) {
        showStatus('لا توجد بطاقات لحفظها!', 'error');
        return;
    }
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(gameData, null, 2));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", "naruto-cards.json");
    document.body.appendChild(downloadAnchorNode);
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
    showStatus('تم حفظ البطاقات بنجاح!');
}

function importGameData(event) {
    const file = event.target.files[0];
    if (!file) {
        return;
    }
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            deck1 = data.deck1;
            deck2 = data.deck2;
            
            // FIX: Pass the imported decks to the deck loader
            loadDeckFromData(data);
            showStatus('تم استيراد البطاقات بنجاح!');
        } catch (error) {
            console.error('خطأ في استيراد الملف:', error);
            showStatus('حدث خطأ في استيراد الملف. تأكد من أنه ملف صالح.', 'error');
        }
    };
    reader.readAsText(file);
}

function toggleFogEffect() {
  const allCards = document.querySelectorAll('#match .card img, .round-slot img');
  allCards.forEach(img => {
    img.classList.toggle('card-foggy');
  });
}

function toggleFullScreen() {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      console.log(`خطأ في تفعيل وضع ملء الشاشة: ${err.message}`);
    });
  } else {
    document.exitFullscreen();
  }
}

document.addEventListener('DOMContentLoaded', () => {
    createRoundSlots('rounds-container1', deck1);
    createRoundSlots('rounds-container2', deck2);

    createNoteShortcuts(1, 'shortcuts1');
    createNoteShortcuts(2, 'shortcuts2');

    handleTextDirection(document.getElementById('notes1'));
    handleTextDirection(document.getElementById('notes2'));
    
    initAudioSystem();
    
    const transparencySlider = document.getElementById('transparency-slider');
    const zoomModal = document.getElementById('zoom-modal');
    const transparencyControl = document.querySelector('.transparency-control');

    transparencySlider.addEventListener('input', function() {
        const opacity = this.value / 100;
        zoomModal.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`;
    });

    document.getElementById('player1-card').addEventListener('dblclick', () => {
        const cardImg = document.getElementById('card1');
        if (cardImg.src) {
            showZoomModal(cardImg.src);
        }
    });

    document.getElementById('player2-card').addEventListener('dblclick', () => {
        const cardImg = document.getElementById('card2');
        if (cardImg.src) {
            showZoomModal(cardImg.src);
        }
    });

    document.getElementById('previous-card1').parentElement.addEventListener('dblclick', (e) => {
        const img = e.target;
        if (img.src) {
            showZoomModal(img.src);
        }
    });
    
    document.getElementById('previous-card2').parentElement.addEventListener('dblclick', (e) => {
        const img = e.target;
        if (img.src) {
            showZoomModal(img.src);
        }
    });
    
    document.getElementById('fullscreen-btn').addEventListener('click', toggleFullScreen);

    document.addEventListener('fullscreenchange', () => {
      const icon = document.getElementById('fullscreen-icon');
      if (document.fullscreenElement) {
        icon.textContent = '❌'; 
      } else {
        icon.textContent = '⛶';
      }
    });
});
</script>
</body>
</html>
